(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/create"],{226:function(t,e,s){"use strict";(function(t,e){var i=s(4);s(26);i(s(25));var o=i(s(227));t.__webpack_require_UNI_MP_PLUGIN__=s,e(o.default)}).call(this,s(1)["default"],s(2)["createPage"])},227:function(t,e,s){"use strict";s.r(e);var i=s(228),o=s(230);for(var n in o)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return o[t]}))}(n);s(232);var r,a=s(32),d=Object(a["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,null,null,!1,i["components"],r);d.options.__file="pages/order/create.vue",e["default"]=d.exports},228:function(t,e,s){"use strict";s.r(e);var i=s(229);s.d(e,"render",(function(){return i["render"]})),s.d(e,"staticRenderFns",(function(){return i["staticRenderFns"]})),s.d(e,"recyclableRender",(function(){return i["recyclableRender"]})),s.d(e,"components",(function(){return i["components"]}))},229:function(t,e,s){"use strict";var i;s.r(e),s.d(e,"render",(function(){return o})),s.d(e,"staticRenderFns",(function(){return r})),s.d(e,"recyclableRender",(function(){return n})),s.d(e,"components",(function(){return i}));var o=function(){var t=this,e=t.$createElement,s=(t._self._c,t.round2pos(t.goodsTotal-t.cur_coupon.price+t.postage));t.$mp.data=Object.assign({},{$root:{m0:s}})},n=!1,r=[];o._withStripped=!0},230:function(t,e,s){"use strict";s.r(e);var i=s(231),o=s.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e["default"]=o.a},231:function(t,e,s){"use strict";(function(t){var i=s(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(s(34)),n={data:function(){return{maskState:0,desc:"",payType:1,couponList:[{title:"新用户专享优惠券",price:5},{title:"庆五一发一波优惠券",price:10},{title:"优惠券优惠券优惠券优惠券",price:15}],cur_coupon:{title:"",price:0},addressData:{name:"点击添加收货地址",pickerText:"",addressName:"",area:""},addressList:[],postage:0,goods:{},sku:{},goods_list:[],userInfo:{id:-1},submit_lock:0,goodsTotal:0,secretKey:o.default.data_secret_key}},onLoad:function(t){},onShow:function(){this.loadData(),this.loadAddress()},watch:{goods_list:{handler:function(t,e){this.calcGoodsAmount()},deep:!0}},methods:{round2pos:function(t){return this.$round2pos(t)},locateAddress:function(t){var e=this.addressList,s=!1;for(var i in e){var o=e[i];if(1==o.is_default){this.addressData={name:o.receiver_name,mobile:o.receiver_phone,pickerText:"".concat(o.province,"-").concat(o.city,"-").concat(o.district),addressName:o.detail_address,area:""},s=!0;break}}if(!s&&e.length>0){var n=e[0];this.addressData={name:n.receiver_name,mobile:n.receiver_phone,pickerText:"".concat(n.province,"-").concat(n.city,"-").concat(n.district),addressName:n.detail_address,area:""}}},loadAddress:function(){var e=this,s=this.getUser()||{};if(!s.id)return t.hideLoading(),void this.$toast("请先登录");var i=this;this.$get("/wx_mini_app/wx_auth/address/".concat(s.id),{},(function(s){t.hideLoading(),s&&s.items?(i.addressList=s.items,e.locateAddress()):i.addressList=[]}),(function(e){t.hideLoading(),i.$toast("获取地址列表失败"),i.addressList=[]}))},loadData:function(){this.goods_list=this.$dataLocal("buy_list"),this.calcGoodsAmount(),this.userInfo=this.getUser()},calcGoodsAmount:function(){var t=this.goods_list,e=0;for(var s in t){var i=t[s],o=i.goods.price,n=parseFloat(o)*parseFloat(i.number);e+=n}this.goodsTotal=this.$round2pos(e)},discard:function(){},sub:function(t){if(!(t.number<=1)){var e=1;1==t.goods.type&&(e=1),t.number=t.number-e}},add:function(t){var e=1;1==t.goods.type&&(e=1),t.number=parseFloat(t.number)+parseFloat(e)},choseCoupon:function(t){this.cur_coupon=t,this.toggleMask()},toggleMask:function(t){var e=this,s="show"===t?10:300,i="show"===t?1:0;this.maskState=2,setTimeout((function(){e.maskState=i}),s)},numberChange:function(t){this.number=t.number},changePayType:function(t){this.payType=t},submit:function(){this._submit()},_submit:function(){if("点击添加收货地址"!=this.addressData.name)if(this.addressData.pickerText){var t={};t.amount=this.goodsTotal,t.benefit=this.cur_coupon.price,t.postage=this.postage;var e=[];for(var s in this.goods_list){var i={},o=this.goods_list[s];console.log(o),i.product_id=o.goods.product_id||o.goods.id,i.number=o.number,i.name=o.goods.name,i.price=o.goods.price,i.cart_id=o.goods.cart_id,e.push(i)}t.address=JSON.stringify(this.addressData),t.goodsDetail=JSON.stringify(e),t.memo=this.desc;var n={};if(this.$isNull(this.userInfo.id))this.$toast("请先登陆");else{var r=(new Date).getTime();if(n.id=this.userInfo.id,this.userInfo.headimage&&(n.headimage=this.userInfo.headimage),this.userInfo.mobile&&(n.mobile=this.userInfo.mobile),this.userInfo.nickname&&(n.nickname=this.userInfo.nickname),t.userDetail=JSON.stringify(n),t.userId=this.userInfo.id,t.timestamp=r,1!=this.submit_lock){this.submit_lock=1;var a=this,d=this.$hexHash({secretKey:this.secretKey,timestamp:t.timestamp});t.signStr=d,this.$post("/wx_mini_app/shop-order",t,(function(t){if(t&&200==t.code){var e=t.data.id,s=a.goodsTotal-a.cur_coupon.price+a.postage;a.isH5()?a.$naviExter("./external/wxpay.html?order_id="+e+"&money="+s):a.$redirectTo("/pages/pay/pay?order_id="+e+"&money="+s)}else t&&400==t.code?a.$toast(t.message):(a.submit_lock=0,a.$toast("订单提交失败，请重试"))}),(function(t){console.error("订单提交失败",t),a.submit_lock=0,a.$toast("订单提交失败，请重试")}))}}}else this.$toast("请选择邮寄区域");else this.$toast("请填写地址")},stopPrevent:function(){}}};e.default=n}).call(this,s(2)["default"])},232:function(t,e,s){"use strict";s.r(e);var i=s(233),o=s.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e["default"]=o.a},233:function(t,e,s){}},[[226,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/order/create.js.map