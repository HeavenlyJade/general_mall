(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/set"],{146:function(e,n,t){"use strict";(function(e,n){var i=t(4);t(26);i(t(25));var o=i(t(147));e.__webpack_require_UNI_MP_PLUGIN__=t,n(o.default)}).call(this,t(1)["default"],t(2)["createPage"])},147:function(e,n,t){"use strict";t.r(n);var i=t(148),o=t(150);for(var r in o)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(r);t(152);var s,a=t(32),u=Object(a["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,null,null,!1,i["components"],s);u.options.__file="pages/user/set.vue",n["default"]=u.exports},148:function(e,n,t){"use strict";t.r(n);var i=t(149);t.d(n,"render",(function(){return i["render"]})),t.d(n,"staticRenderFns",(function(){return i["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return i["recyclableRender"]})),t.d(n,"components",(function(){return i["components"]}))},149:function(e,n,t){"use strict";var i;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return s})),t.d(n,"recyclableRender",(function(){return r})),t.d(n,"components",(function(){return i}));var o=function(){var e=this,n=e.$createElement,t=(e._self._c,e.loading?null:e.user.avatar||e.getConst().defaultAvatar),i=e.loading?null:parseInt(e.user.gender||0),o=e.loading?null:e.getConst(),r=e.loading?null:e.getConst(),s=e.loading?null:parseInt(e.user.gender||0);e.$mp.data=Object.assign({},{$root:{m0:t,m1:i,m2:o,m3:r,m4:s}})},r=!1,s=[];o._withStripped=!0},150:function(e,n,t){"use strict";t.r(n);var i=t(151),o=t.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(r);n["default"]=o.a},151:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t={components:{},data:function(){return{loading:!0,user:{id:null,user_id:null,gender:0,phone:"",address:null,avatar:"",nickname:"",username:"",member_level:"无会员",points:0,balance:0,avatarurl:null}}},onLoad:function(e){this.loadData()},onShow:function(){this.$toast(this.getConst().version_code)},methods:{bindPickerChange:function(e){this.user.gender=e.detail.value,this.user=JSON.parse(JSON.stringify(this.user)),console.log(this.user)},refreshwx:function(){this.updateWxLogin()},choseimg:function(){var e=this;this.$chooseImageUpload(1,(function(n){if(console.log("上传结果:",n),n&&n.length>0){var t=n[0];t&&!t.startsWith("http")&&(t=t.startsWith("//")?"http:"+t:"http://"+t),e.user.avatar=t,e.user.avatarurl=t,e.user=JSON.parse(JSON.stringify(e.user)),console.log("更新后的用户头像:",e.user.avatar)}}))},updatePwd:function(){this.$navigateTo("login/forget")},loadData:function(){var n=this;this.loading=!0,e.showLoading({title:"加载中..."}),this.$refreshUser(this.getUser().id,(function(t){if(console.log("res",t),t){var i=t.id,o=t.user_id,r=t.gender,s=void 0===r?0:r,a=t.phone,u=void 0===a?"":a,l=t.address,c=void 0===l?null:l,d=t.avatar,f=void 0===d?"":d,h=t.nickname,g=void 0===h?"":h,v=t.username,p=void 0===v?"":v,m=t.member_level,_=void 0===m?"无会员":m,b=t.points,$=void 0===b?0:b,w=t.balance,k=void 0===w?0:w;n.user={id:i,user_id:o,gender:s,phone:u,address:c,avatar:f,nickname:g||"微信用户",username:p||"",member_level:_,points:$,balance:k},console.log("用户数据加载完成:",n.user)}else console.error("获取用户数据失败或数据为空");n.loading=!1,e.hideLoading()}),(function(t){console.error("加载用户数据出错:",t),n.loading=!1,e.hideLoading(),e.showToast({title:"获取用户信息失败",icon:"none"})}))},confirm:function(){if(this.validatePhone()){var n={id:this.user.id,real_name:this.user.real_name,nickname:this.user.nickname,gender:this.user.gender,avatar:this.user.avatar,phone:this.user.phone},t=this,i=this.user.id,o="/mini_core/shop_users/".concat(i);this.$put(o,n,(function(n){console.log("res",n),n?(t.setUser(n),e.showToast({title:"保存成功",icon:"success"}),setTimeout((function(){e.navigateBack()}),800)):e.showToast({title:n.msg||"保存失败",icon:"none"})}))}},toreg:function(){(this.$isNull(this.user.id)||this.$isNull(this.user.phone))&&(this.$dataLocal("pre_reg_page","/pages/user/set"),this.$redirectTo("login/register"))},toLogout:function(){var n=this;e.showModal({title:"确定要退出登录么？",success:function(e){e.confirm&&(n.$rmLoginMsg(),n.$reLaunch("login/login"))}})},switchChange:function(e){console.log(e.detail);var n=e.detai?"打开":"关闭";this.$api.msg("".concat(n,"消息推送"))},validatePhone:function(){var n=/^1[3-9]\d{9}$/;return this.user.phone?!!n.test(this.user.phone)||(e.showToast({title:"请输入正确的手机号码",icon:"none"}),!1):(e.showToast({title:"请输入手机号码",icon:"none"}),!1)}}};n.default=t}).call(this,t(2)["default"])},152:function(e,n,t){"use strict";t.r(n);var i=t(153),o=t.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(r);n["default"]=o.a},153:function(e,n,t){}},[[146,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/user/set.js.map